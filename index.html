import pandas as pd

# Cargar el archivo Excel (asegúrate de que el archivo esté en la misma carpeta que este script)
df = pd.read_excel("dispersion.xlsx", sheet_name="data")

# Convertir la tabla a HTML sin índice
table_html = df.to_html(index=False, classes="table table-striped table-bordered", border=0)

# Crear archivo HTML
html_content = f"""
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Dispersión</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {{
            background: #f8f9fa;
            padding: 20px;
        }}
        h1 {{
            text-align: center;
            margin-bottom: 20px;
        }}
        .filters {{
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }}
        .table-container {{
            max-height: 600px;
            overflow-y: auto;
        }}
    </style>
</head>
<body>
    <h1>Dashboard de Dispersión</h1>

    <!-- Filtros -->
    <div class="filters">
        <div>
            <label for="semanaFilter">Semana:</label>
            <select id="semanaFilter" class="form-select">
                <option value="">Todos</option>
                {"".join([f'<option value="{val}">{val}</option>' for val in sorted(df['Semana'].dropna().unique())])}
            </select>
        </div>

        <div>
            <label for="operacionFilter">Operación:</label>
            <select id="operacionFilter" class="form-select">
                <option value="">Todos</option>
                {"".join([f'<option value="{val}">{val}</option>' for val in sorted(df['Operación'].dropna().unique())])}
            </select>
        </div>

        <div>
            <label for="flotaFilter">FLOTA:</label>
            <select id="flotaFilter" class="form-select">
                <option value="">Todos</option>
                {"".join([f'<option value="{val}">{val}</option>' for val in sorted(df['FLOTA'].dropna().unique())])}
            </select>
        </div>

        <div>
            <label for="movilSearch">Móvil:</label>
            <input type="text" id="movilSearch" class="form-control" placeholder="Buscar móvil...">
        </div>
    </div>

    <!-- Tabla -->
    <div class="table-container">
        {table_html}
    </div>

    <script>
        $(document).ready(function() {{
            function filtrar() {{
                var semana = $("#semanaFilter").val().toLowerCase();
                var operacion = $("#operacionFilter").val().toLowerCase();
                var flota = $("#flotaFilter").val().toLowerCase();
                var movil = $("#movilSearch").val().toLowerCase();

                $("table tbody tr").each(function() {{
                    var row = $(this);
                    var rowSemana = row.find("td:eq(1)").text().toLowerCase();   // Columna Semana
                    var rowMovil = row.find("td:eq(2)").text().toLowerCase();    // Columna Móvil
                    var rowOperacion = row.find("td:eq(3)").text().toLowerCase();// Columna Operación
                    var rowFlota = row.find("td:eq(4)").text().toLowerCase();    // Columna FLOTA

                    var show = true;

                    if (semana && rowSemana !== semana) show = false;
                    if (operacion && rowOperacion !== operacion) show = false;
                    if (flota && rowFlota !== flota) show = false;
                    if (movil && !rowMovil.includes(movil)) show = false;

                    row.toggle(show);
                }});
            }}

            $("#semanaFilter, #operacionFilter, #flotaFilter").on("change", filtrar);
            $("#movilSearch").on("keyup", filtrar);
        }});
    </script>
</body>
</html>
"""

with open("dashboard.html", "w", encoding="utf-8") as f:
    f.write(html_content)

print("✅ Dashboard generado: abre el archivo 'dashboard.html'")

